{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-edit me-2"></i>Редактирование животного</h1>
    <a href="{{ url_for('animals') }}" class="btn btn-secondary">
        <i class="fas fa-arrow-left me-2"></i>Назад к списку
    </a>
</div>

<div class="card">
    <div class="card-header">
        <h5 class="mb-0">Редактирование: {{ animal[1] or 'Без имени' }}</h5>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('edit_animal', animal_id=animal[0]) }}" enctype="multipart/form-data">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Имя животного:</label>
                        <input type="text" name="name" class="form-control" value="{{ animal[1] or '' }}" placeholder="Например: Бычок-1">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Вид:</label>
                        <select name="species" class="form-control" required>
                            <option value="">Выберите вид</option>
                            <option value="бычок" {% if animal[2] == 'бычок' %}selected{% endif %}>Бычок</option>
                            <option value="корова" {% if animal[2] == 'корова' %}selected{% endif %}>Корова</option>
                            <option value="баран" {% if animal[2] == 'баран' %}selected{% endif %}>Баран</option>
                            <option value="лошадь" {% if animal[2] == 'лошадь' %}selected{% endif %}>Лошадь</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Порода:</label>
                        <input type="text" name="breed" class="form-control" value="{{ animal[3] or '' }}" placeholder="Например: ангус" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Тип вакцины:</label>
                        <input type="text" name="vaccination_type" class="form-control" value="{{ animal[11] or '' }}" placeholder="Например: Вакцина от ящура">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Дата вакцинации:</label>
                        <input type="date" name="vaccination_date" class="form-control" value="{{ animal[12] or '' }}">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Дата рождения:</label>
                        <input type="date" name="birth_date" class="form-control" value="{{ animal[4] }}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Текущий вес (кг):</label>
                        <input type="number" step="0.1" name="current_weight" class="form-control" value="{{ animal[5] }}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Статус:</label>
                        <select name="status" class="form-control" required>
                            <option value="на откорме" {% if animal[8] == 'на откорме' %}selected{% endif %}>На откорме</option>
                            <option value="готов к забою" {% if animal[8] == 'готов к забою' %}selected{% endif %}>Готов к забою</option>
                            <option value="продан" {% if animal[8] == 'продан' %}selected{% endif %}>Продан</option>
                            <option value="забит" {% if animal[8] == 'забит' %}selected{% endif %}>Забит</option>
                        </select>
                    </div>
                    <!-- В форму редактирования добавьте после поля "Статус": -->
                    <div class="mb-3">
                        <label class="form-label">Цена (₸):</label>
                        <input type="number" step="0.01" name="price" class="form-control" 
                        value="{{ animal[16] if animal[16] else '' }}"
                        {% if animal[8] != 'готов к забою' %}disabled{% endif %}>
                        <small class="text-muted">
                        Цена отображается только для животных со статусом "готов к забою"
                        </small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Следующая вакцинация:</label>
                        <input type="date" name="next_vaccination_date" class="form-control" value="{{ animal[13] or '' }}">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Примечания к вакцинации:</label>
                        <textarea name="vaccination_notes" class="form-control" rows="3" placeholder="Дополнительная информация о вакцинации">{{ animal[14] or '' }}</textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Новое фото животного:</label>
                        <input type="file" name="photo" class="form-control" accept="image/*">
                        {% if animal[7] %}
                        <div class="mt-2">
                            <small class="text-muted">Текущее фото:</small><br>
                            <img src="{{ url_for('static', filename='uploads/' + animal[7]) }}" 
                                 style="width: 150px; height: 150px; object-fit: cover; border-radius: 8px; margin-top: 5px; cursor: pointer;"
                                 data-bs-toggle="modal" 
                                 data-bs-target="#currentPhotoModal">
                            <br>
                            <small class="text-muted">Нажмите на фото для просмотра</small>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="mt-3">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-2"></i>Сохранить изменения
                </button>
                <a href="{{ url_for('animals') }}" class="btn btn-secondary">Отмена</a>
            </div>
        </form>
    </div>
</div>

<!-- Модальное окно для просмотра текущего фото -->
{% if animal[7] %}
<div class="modal fade" id="currentPhotoModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Текущее фото: {{ animal[1] or 'Без имени' }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <img src="{{ url_for('static', filename='uploads/' + animal[7]) }}" 
                     class="img-fluid" 
                     style="max-height: 70vh; object-fit: contain;"
                     alt="{{ animal[1] }}">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}